(this["webpackJsonp"]=this["webpackJsonp"]||[]).push([["chunk-65476960"],{"0f32":function(e,t,i){var n=i("b047c"),a=i("1a8c"),o="Expected a function";function r(e,t,i){var r=!0,s=!0;if("function"!=typeof e)throw new TypeError(o);return a(i)&&(r="leading"in i?!!i.leading:r,s="trailing"in i?!!i.trailing:s),n(e,t,{leading:r,maxWait:t,trailing:s})}e.exports=r},"269a":function(e,t){e.exports=function(e,t){var i="function"===typeof e.exports?e.exports.extendOptions:e.options;for(var n in"function"===typeof e.exports&&(i.directives=e.exports.options.directives),i.directives=i.directives||{},t)i.directives[n]=i.directives[n]||t[n]}},"408c":function(e,t,i){var n=i("2b3e"),a=function(){return n.Date.now()};e.exports=a},"81f6":function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"eorzea-simple-map",staticStyle:{width:"100%",height:"100%",position:"relative"}},[i("v-overlay",{attrs:{value:!e.allImageLoaded,absolute:"",opacity:"1",color:"background"}},[i("div",{staticClass:"d-flex flex-column align-center"},[i("v-progress-circular",{attrs:{indeterminate:"",size:"64",color:"primary"}}),i("div",{staticClass:"mt-2 primary--text"},[e._v(e._s(e.$t("detail.map.loading")))])],1)]),i("v-hover",{attrs:{"open-delay":"200"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.hover;return[i("div",{directives:[{name:"resize",rawName:"v-resize",value:e.resize,expression:"resize"}],ref:"container",staticClass:"map-container",staticStyle:{width:"100%",height:"100%"}},[i("v-scale-transition",{attrs:{origin:"center center"}},[!e.isMobile&&n?i("div",{staticClass:"d-flex justify-center align-center elevation-4 rounded-xl overflow-hidden",staticStyle:{left:"50%",top:"4px",position:"absolute","z-index":"1","margin-left":"-120px"}},[i("v-btn",{staticStyle:{"min-width":"48px"},attrs:{tile:"",height:"48",width:"48",title:"重置地图状态"},on:{click:e.resize}},[i("v-icon",[e._v(e._s(e.mdiArrowCollapse))])],1),i("v-btn-toggle",{staticClass:"rounded-l-0",attrs:{multiple:"",color:"primary"},model:{value:e.mapOptions,callback:function(t){e.mapOptions=t},expression:"mapOptions"}},[i("v-btn",{attrs:{icon:"",title:"隐藏/显示 钓场范围提示（紫色标记）"},on:{click:function(t){return e.toggleLayer("rangeHelperLayer")}}},[i("v-icon",[e._v(e._s(e.mdiWaves))])],1),i("v-btn",{attrs:{icon:"",title:"隐藏/显示 游戏地图图标（大水晶和范围圈）"},on:{click:function(t){return e.toggleLayer("markerRangeLayer")}}},[i("v-icon",[e._v(e._s(e.mdiMapMarkerRadius))])],1),i("v-btn",{attrs:{icon:"",title:"隐藏/显示 钓场名称"},on:{click:function(t){return e.toggleLayer("textLayer")}}},[i("v-icon",[e._v(e._s(e.mdiFormatText))])],1),i("v-btn",{attrs:{icon:"",title:"取消/启用 地图锁（取消后可鼠标移动以及滚轮缩放地图）"},on:{click:e.toggleMapLock}},[i("v-icon",[e._v(e._s(e.mdiLock))])],1)],1)],1):e._e()]),i("v-stage",{ref:"stage",attrs:{config:e.stageConfig}},[i("v-layer",[i("v-image",{attrs:{config:e.defaultMapConfig}}),i("v-image",{attrs:{config:e.mapConfig}})],1),i("v-layer",{ref:"rangeHelperLayer"},e._l(e.fishingSpotRangeHelperLayerConfigs,(function(e,t){return i("v-image",{key:"helper-"+t,attrs:{config:e}})})),1),i("v-layer",{ref:"markerRangeLayer"},[e._l(e.aetheryteMakerConfigs,(function(e,t){return i("v-image",{key:"marker"+t,attrs:{config:e}})})),e._l(e.markerRangeConfigs,(function(e,t){return i("v-image",{key:"range-"+t,attrs:{config:e}})})),e._l(e.fishingSpotMarkerConfigs,(function(e,t){return i("v-image",{key:"marker-"+t,attrs:{config:e}})}))],2),i("v-layer",{ref:"textLayer"},[e._l(e.aetheryteMakerTextConfigs,(function(t){return i("v-text",{key:"aetheryte-"+t.text,attrs:{config:t},on:{click:function(i){return e.copyText(t.text)},mouseenter:e.switchMouseToPointer,mouseleave:e.switchMouseToDefault}})})),e._l(e.fishingSpotTextConfigs,(function(t){return i("v-text",{key:"spot-"+t.text,attrs:{config:t},on:{click:function(i){return e.copyText(t.text)},mouseenter:e.switchMouseToPointer,mouseleave:e.switchMouseToDefault}})}))],2)],1)],1)]}}])})],1)},a=[],o=(i("99af"),i("d81d"),i("b0c0"),i("a9e3"),i("d3b7"),i("ac1f"),i("3ca3"),i("1276"),i("ddb0"),i("5530")),r=i("0f5c"),s=i.n(r),l=i("0f32"),c=i.n(l),u=i("63ea"),p=i.n(u),f=i("2f62"),d=i("94ed"),h=i("1aeb"),g=i("04d5"),m=i("7a7d"),v=i("f904"),S=i.n(v),x=i("1879"),y=i.n(x),k=50,w=90,b=70,I=2048,C={name:"EorzeaSimpleMap",mixins:[g["a"]],props:{fishingSpots:{type:Array,default:function(){return[]}},id:{type:String,default:void 0},sizeFactor:{type:Number,default:void 0},mode:{type:String,default:"local"},ratio:{type:Number,default:1},showFishingRangeHelper:{type:Boolean,default:!0}},data:function(){return{mdiArrowCollapse:d["g"],mdiWaves:d["Ob"],mdiMapMarkerRadius:d["mb"],mdiFormatText:d["Z"],mdiLock:d["ib"],fishMarker:m["a"].getImgUrl("fishingSpot.webp"),markerRange:m["a"].getImgUrl("markerRange.webp"),defaultMap:m["a"].getMapUrl("default.00.webp",m["a"].CATEGORY.MAP),aetheryteMarker:m["a"].getImgUrl("PlaceName.webp"),stage:void 0,mapOptions:[0,1,2,3],defaultMapImage:null,mapImage:null,fishingSpotImage:null,markerRangeImage:null,aetheryteImage:null,containerWidth:760,containerHeight:760,mapImageLoaded:!1,fishingSpotRangeHelperLoaded:!1,throttledResizeFn:void 0,fishingSpotRangeHelperImages:[],mapLocked:!0}},computed:Object(o["a"])({mapImageUrl:function(){var e=this.id.split("/");return"remote"===this.mode?"".concat(h["a"].XIV_API_HOST,"/m/").concat(e[0],"/").concat(e[0],".").concat(e[1],".jpg"):m["a"].getMapUrl("".concat(e[0],".").concat(e[1],".webp"))},stageConfig:function(){return{x:0,width:this.containerWidth,height:this.containerHeight,scaleX:this.containerHeight/I,scaleY:this.containerHeight/I,draggable:!this.mapLocked,preventDefault:!1}},defaultMapConfig:function(){return{image:this.defaultMapImage,x:0,y:0,width:I,height:I,preventDefault:!1}},mapConfig:function(){return{image:this.mapImage,x:0,y:0,width:I,height:I,preventDefault:!1}},fishingSpotRangeHelperLayerConfigs:function(){var e=this;return this.fishingSpotRangeHelperLoaded?this.fishingSpots.map((function(t,i){return{image:e.fishingSpotRangeHelperImages[i],x:0,y:0,width:I,height:I,preventDefault:!1}})):[]},fishingSpotMarkerConfigs:function(){var e=this;return this.fishingSpots.map((function(t){return{image:e.fishingSpotImage,x:t.x-48,y:t.y-48,width:96,height:96,preventDefault:!1}}))},markerRangeConfigs:function(){var e=this;return this.fishingSpots.map((function(t){var i=t.radius/300;return{image:e.markerRangeImage,x:t.x-96*i/2,y:t.y-96*i/2,width:96,height:96,scaleX:i,scaleY:i,preventDefault:!1}}))},aetheryteMakerConfigs:function(){var e,t,i=this;return null!==(e=null===(t=this.aetheryte[this.id])||void 0===t?void 0:t.map((function(e){return{image:i.aetheryteImage,x:e.x-62,y:e.y-62,width:124,height:124,preventDefault:!1}})))&&void 0!==e?e:[]},aetheryteMakerTextConfigs:function(){var e,t,i=this;return null!==(e=null===(t=this.aetheryte[this.id])||void 0===t?void 0:t.map((function(e){var t=h["a"].getName(y.a[e.placeNameId]);return i.computeSafeTextConfig(t,e.x,e.y,{fontSize:w,preventDefault:!1})})))&&void 0!==e?e:[]},fishingSpotTextConfigs:function(){var e=this;return this.fishingSpots.map((function(t){return e.computeSafeTextConfig(t.name,t.x,t.y,{fontSize:b,color:"white",preventDefault:!1})}))},allImageLoaded:function(){return this.mapImageLoaded&&this.fishingSpotRangeHelperLoaded&&null!=this.fishingSpotImage&&null!=this.markerRangeImage},fishingSpotIds:function(){return this.fishingSpots.map((function(e){return e._id}))}},Object(f["e"])(["aetheryte"])),watch:{allImageLoaded:function(e){e&&this.resize()},mapImageUrl:function(e){this.loadMapImage(e)},fishingSpotIds:function(e,t){p()(t,e)||this.loadFishingSpotRangeHelper(e)}},created:function(){var e=this;this.loadMapImage(this.mapImageUrl),this.loadFishingSpotRangeHelper(this.fishingSpotIds),this.loadImageToProp(this.defaultMap,"defaultMapImage"),this.loadImageToProp(this.fishMarker,"fishingSpotImage"),this.loadImageToProp(this.markerRange,"markerRangeImage"),this.loadImageToProp(this.aetheryteMarker,"aetheryteImage"),this.throttledResizeFn=c()((function(){return e.resizeInternal()}),300)},mounted:function(){var e=this,t=this.$refs.stage.getNode();t.on("wheel",(function(i){if(!e.mapLocked){i.evt.preventDefault();var n=1.5,a=t.scaleX(),o=t.getPointerPosition(),r={x:(o.x-t.x())/a,y:(o.y-t.y())/a},s=i.evt.deltaY<0?a*n:a/n,l=s*I>100?s:a;t.scale({x:l,y:l});var c={x:o.x-r.x*l,y:o.y-r.y*l};t.position(c),t.batchDraw()}}))},methods:Object(o["a"])({getOffset:function(e){return e/2},getSafePos:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=I-k,a=k,o=e+t/2+i,r=e-t/2-i;return r<a?a+t/2:o>n?n-t/2:e},getSafeY:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=I-k,a=e+t/2+i;return a>n?e-t/2-i:e+t/2+i},loadMapImage:function(e){var t=this;this.mapImageLoaded=!1,this.loadImageToProp(e,"mapImage").then((function(){return t.mapImageLoaded=!0}))},loadFishingSpotRangeHelper:function(e){var t=this;this.fishingSpotRangeHelperLoaded=!1,Promise.all(e.map((function(e,i){return t.loadImageToProp(t.getFishingSpotRangeHelper(e),"fishingSpotRangeHelperImages[".concat(i,"]"))}))).then((function(){return t.fishingSpotRangeHelperLoaded=!0}))},loadImageToProp:function(e,t){var i=this;return Promise.resolve(e).then((function(e){if(null!=e){var n=new window.Image;return n.src=e,new Promise((function(e){n.onload=function(){s()(i,t,n),e()},n.onerror=function(){var n=new window.Image;n.src=m["a"].getImgUrl("default.webp",m["a"].CATEGORY.MAP_RANGE_INDICATOR),n.onload=function(){s()(i,t,n),e()}}}))}s()(i,t,null)}))},getFishingSpotRangeHelper:function(e){var t=this.showFishingRangeHelper?e:"default";return this.showFishingRangeHelper&&"default"===t&&console.warn(e+" range helper is missing."),m["a"].getImgUrl(t+".webp",m["a"].CATEGORY.MAP_RANGE_INDICATOR)},resize:function(){this.throttledResizeFn()},getStage:function(){return this.stage?this.stage:null===(e=this.$refs.stage)||void 0===e?void 0:e.getNode();var e},toggleLayer:function(e){var t=this.$refs[e].getNode();t.visible(!t.visible()),t.draw()},toggleMapLock:function(){var e=this.getStage();e.draggable(!e.draggable()),this.mapLocked=!this.mapLocked,e.batchDraw()},resizeInternal:function(){var e,t=this.$refs.container.getBoundingClientRect();if(t&&null!==t&&void 0!==t&&t.width&&null!==t&&void 0!==t&&t.height){this.containerWidth=null===t||void 0===t?void 0:t.width,this.containerHeight=null===t||void 0===t?void 0:t.height;var i=Math.min(this.containerHeight,this.containerWidth),n=null===(e=this.$refs.stage)||void 0===e?void 0:e.getNode();null===n||void 0===n||n.scale({x:i/I,y:i/I}),null===n||void 0===n||n.position({x:this.containerWidth/2-i/2,y:0}),n.batchDraw()}},copyText:function(e){S()(e),this.showSnackbar({text:this.$t("importExport.dialog.message.copySuccess"),color:"success"})},switchMouseToPointer:function(){this.$refs.stage.getNode().container().style.cursor="pointer"},switchMouseToDefault:function(){this.$refs.stage.getNode().container().style.cursor="default"},computeSafeTextConfig:function(e,t,i,n){var a,o,r=h["a"].hasChineseCharacter(e)?e.length:e.length/2,s=n.fontSize*r,l=n.fontSize;return{text:e,width:s,offsetX:this.getOffset(s),height:l,offsetY:this.getOffset(l),x:this.getSafePos(t,s),y:this.getSafeY(i,l,l/2+10),align:"center",fontSize:n.fontSize,fill:null!==(a=n.color)&&void 0!==a?a:"black",stroke:null!==(o=n.color)&&void 0!==o?o:"black",strokeWidth:1,shadowColor:"black",shadowBlur:10,shadowOffset:{x:8,y:8},shadowOpacity:.5}}},Object(f["d"])(["showSnackbar"]))},M=C,_=i("2877"),L=i("6544"),R=i.n(L),T=i("8336"),z=i("a609"),H=i("ce87"),O=i("132d"),V=i("a797"),P=i("490a"),N=i("0789"),E=i("269a"),F=i.n(E),D=i("dc22"),W=Object(_["a"])(M,n,a,!1,null,"1897e2ad",null);t["a"]=W.exports;R()(W,{VBtn:T["a"],VBtnToggle:z["a"],VHover:H["a"],VIcon:O["a"],VOverlay:V["a"],VProgressCircular:P["a"],VScaleTransition:N["e"]}),F()(W,{Resize:D["a"]})},ae17:function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"d-flex flex-column align-center"},[i("v-expansion-panels",{attrs:{hover:"",flat:"",tile:""},model:{value:e.lazyExpansionValue,callback:function(t){e.lazyExpansionValue=t},expression:"lazyExpansionValue"}},[i("v-expansion-panel",{staticClass:"systemSecondary"},[i("v-expansion-panel-header",{staticClass:"systemSecondary"},[i("div",{staticStyle:{display:"flex","align-items":"center","justify-content":"center"}},[e.multiple?i("div",[i("v-menu",{attrs:{"offset-x":"",top:""},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on,a=t.attrs;return[i("v-btn",e._g(e._b({attrs:{icon:"",text:""}},"v-btn",a,!1),n),[i("v-icon",[e._v(e._s(e.mdiViewList))])],1)]}}],null,!1,209410721),model:{value:e.showSpotMenu,callback:function(t){e.showSpotMenu=t},expression:"showSpotMenu"}},[i("v-list",e._l(e.fishingSpots,(function(t,n){return i("v-list-item",{key:n,on:{click:function(t){t.stopPropagation(),e.currentSpotIndex=n}}},[i("v-list-item-title",{staticClass:"d-flex align-center"},[i("link-list",{attrs:{id:t.fishingSpotId,"angler-id":t.fishingSpot.anglerLocationId,name:t.fishingSpotName,mode:"spot","spot-mode":e.fish.type,disabled:e.showSpotLink},on:{click:function(t){return e.listLinkClicked(t)}}},[i("v-hover",{scopedSlots:e._u([{key:"default",fn:function(n){var a=n.hover;return[i("div",{class:"text-subtitle-1 "+(a&&!e.showSpotLink?"text-decoration-underline":"")},[e._v(" "+e._s(t.fishingSpotName)+" ")])]}}],null,!0)})],1),i("v-spacer"),i("div",{staticClass:"ml-2 subtitle-2"},[e._v(e._s(t.zone))])],1)],1)})),1)],1)],1):e._e(),i("div",{staticClass:"text-subtitle-1",attrs:{title:e.toSpotTitle(e.currentSpot)}},[i("link-list",{attrs:{id:e.currentSpot.fishingSpotId,"angler-id":e.currentSpot.fishingSpot.anglerLocationId,name:e.currentSpot.fishingSpotName,names:e.currentSpot.fishingSpotNames,mode:"spot","spot-mode":e.fish.type,disabled:e.showSpotLink},on:{click:function(t){return e.listLinkClicked(t)}}},[i("v-hover",{scopedSlots:e._u([{key:"default",fn:function(t){var n=t.hover;return[i("div",{class:"text-subtitle-1 "+(n&&!e.showSpotLink?"info--text text-decoration-underline":"")},[e._v(" "+e._s(e.currentSpot.fishingSpotName)+" ")])]}}])})],1)],1),i("div",{staticClass:"text-subtitle-2 ml-2"},[e._v(" "+e._s(e.currentSpot.zone)+" ")]),i("div",{staticClass:"text-subtitle-1 ml-2"},[e._v(" ("+e._s(e.currentSpot.fishSpotPositionText)+") ")]),i("click-helper",{attrs:{"copy-text":e.currentSpot.fishingSpotName},on:{click:function(e){e.stopPropagation()}}},[i("v-btn",{staticClass:"my-2",attrs:{text:"",icon:"",title:e.$t("list.item.copyHint")}},[i("v-icon",[e._v(e._s(e.mdiContentCopy))])],1)],1)],1)])],1)],1),0===e.lazyExpansionValue?i("v-row",{directives:[{name:"resize",rawName:"v-resize",value:e.onWindowResize,expression:"onWindowResize"}],style:"width: 100%; height: 100%; max-width: 512px; max-height: "+e.mapWidth+"px",attrs:{"no-gutters":""}},[i("eorzea-simple-map",{ref:"simpleMap",attrs:{id:e.currentSpot.fishingSpot.mapFileId,"size-factor":e.currentSpot.fishingSpot.size_factor,"fishing-spots":e.fishingSpotsForMap,"show-fishing-range-helper":e.showFishingRangeHelper}})],1):e._e()],1)},a=[],o=i("5530"),r=i("2f62"),s=i("94ed"),l=i("6053"),c=i("1aeb"),u=i("81f6"),p=i("96a9"),f={name:"DetailItemMap",components:{LinkList:p["a"],ClickHelper:l["a"],EorzeaSimpleMap:u["a"]},props:{fish:{type:Object,default:void 0},expanded:{type:Boolean,default:!1},showFishingRangeHelper:{type:Boolean,default:!0},showSpotLink:{type:Boolean,default:!1}},data:function(e){return{mdiViewList:s["Nb"],mdiContentCopy:s["F"],currentSpotIndex:0,lazyExpansionValue:e.expanded?0:void 0,showSpotMenu:!1,mapWidth:512}},computed:Object(o["a"])({fishingSpots:function(){return this.fish.fishingSpots},currentSpot:function(){return this.fishingSpots[this.currentSpotIndex]},fishingSpotsForMap:function(){return[Object(o["a"])(Object(o["a"])({},this.currentSpot.fishingSpot),{},{name:this.currentSpot.fishingSpotName})]},multiple:function(){return this.fishingSpots.length>1}},Object(r["c"])(["getFishingSpot"])),created:function(){this.lazyExpansionValue=this.expanded?0:void 0},watch:{expanded:function(e){this.lazyExpansionValue=e?0:void 0},"fish.id":function(){this.lazyExpansionValue=this.expanded?0:void 0,this.currentSpotIndex=0}},methods:Object(o["a"])({toSpotTitle:c["a"].toSpotTitle,onWindowResize:function(){var e,t;this.mapWidth=null!==(e=null===(t=this.$refs.simpleMap)||void 0===t?void 0:t.containerWidth)&&void 0!==e?e:512},listLinkClicked:function(e){this.showSpotMenu=!1,e&&this.$emit("close-dialog")},getName:c["a"].getName},Object(r["d"])(["showSnackbar"]))},d=f,h=i("2877"),g=i("6544"),m=i.n(g),v=i("8336"),S=i("cd55"),x=i("c865"),y=i("0393"),k=i("ce87"),w=i("132d"),b=i("8860"),I=i("da13"),C=i("5d23"),M=i("e449"),_=i("0fd9"),L=i("2fa4"),R=i("269a"),T=i.n(R),z=i("dc22"),H=Object(h["a"])(d,n,a,!1,null,"d8984efe",null);t["default"]=H.exports;m()(H,{VBtn:v["a"],VExpansionPanel:S["a"],VExpansionPanelHeader:x["a"],VExpansionPanels:y["a"],VHover:k["a"],VIcon:w["a"],VList:b["a"],VListItem:I["a"],VListItemTitle:C["c"],VMenu:M["a"],VRow:_["a"],VSpacer:L["a"]}),T()(H,{Resize:z["a"]})},b047c:function(e,t,i){var n=i("1a8c"),a=i("408c"),o=i("b4b0"),r="Expected a function",s=Math.max,l=Math.min;function c(e,t,i){var c,u,p,f,d,h,g=0,m=!1,v=!1,S=!0;if("function"!=typeof e)throw new TypeError(r);function x(t){var i=c,n=u;return c=u=void 0,g=t,f=e.apply(n,i),f}function y(e){return g=e,d=setTimeout(b,t),m?x(e):f}function k(e){var i=e-h,n=e-g,a=t-i;return v?l(a,p-n):a}function w(e){var i=e-h,n=e-g;return void 0===h||i>=t||i<0||v&&n>=p}function b(){var e=a();if(w(e))return I(e);d=setTimeout(b,k(e))}function I(e){return d=void 0,S&&c?x(e):(c=u=void 0,f)}function C(){void 0!==d&&clearTimeout(d),g=0,c=h=u=d=void 0}function M(){return void 0===d?f:I(a())}function _(){var e=a(),i=w(e);if(c=arguments,u=this,h=e,i){if(void 0===d)return y(h);if(v)return clearTimeout(d),d=setTimeout(b,t),x(h)}return void 0===d&&(d=setTimeout(b,t)),f}return t=o(t)||0,n(i)&&(m=!!i.leading,v="maxWait"in i,p=v?s(o(i.maxWait)||0,t):p,S="trailing"in i?!!i.trailing:S),_.cancel=C,_.flush=M,_}e.exports=c}}]);